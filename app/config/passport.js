'use strict';var GitHubStrategy=require('passport-github').Strategy,User=require('../models/users'),configAuth=require('./auth');module.exports=function(a){a.serializeUser(function(a,b){b(null,a.id)}),a.deserializeUser(function(a,b){User.findById(a,function(a,c){b(a,c)})}),a.use(new GitHubStrategy({clientID:configAuth.githubAuth.clientID,clientSecret:configAuth.githubAuth.clientSecret,callbackURL:configAuth.githubAuth.callbackURL},function(a,b,c,d){process.nextTick(function(){User.findOne({"github.id":c.id},function(a,b){if(a)return d(a);if(b)return d(null,b);var e=new User;e.github.id=c.id,e.github.username=c.username,e.github.displayName=c.displayName,e.github.publicRepos=c._json.public_repos,e.nbrClicks.clicks=0,e.save(function(a){if(a)throw a;return d(null,e)})})})}))};